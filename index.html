<!DOCTYPE html>
<!-- This is based on DillingerLee's great template here:
https://github.com/Team-Code/KA_Offline -->
<html>

<head>
    <title>Guerra naval</title>
</head>

<body>
    <p align="center">
        <!--This draws the Canvas on the webpage -->
        <canvas id="mycanvas"></canvas>
    </p>
</body>

<!-- Run all the JavaScript stuff -->
<!-- Include the processing.js library -->
<!-- See https://khanacademy.zendesk.com/hc/en-us/articles/202260404-What-parts-of-ProcessingJS-does-Khan-Academy-support- for differences -->
<script src="https://cdn.jsdelivr.net/processing.js/1.4.8/processing.min.js"></script>

<script>
    var sketchProc = function (processingInstance) {
        with (processingInstance) {
            size(400, 400);
            frameRate(30);

            //Guerra naval (En proceso)
            var numeroEscena = 1;
            //Pagina principal
            var principal = function () {
                numeroEscena = 1;

                background(137, 129, 247);
                fill(255, 255, 255);
                textSize(20);
                textAlign(CENTER);
                text("GUERRA NAVAL", 193, 98);
                fill(0, 51, 255);
                rect(159, 110, 80, 40, 20);
                fill(255, 255, 255);
                text("PLAY", 201, 139);
                var nave = getImage("space/octopus");
                image(nave, 115, 155);
                mouseClicked = function () {
                    if (mouseX > 159 && mouseX < 239 && mouseY > 110 && mouseY < 150) {
                        numeroEscena = 2;
                    }
                };
            };
            //principal();

            //Juego
            //var juego = function (){

            //Barcos
            var barcos = function (numCuadrados, x, y) {
                this.numCuadrados = numCuadrados;
                this.x = x;
                this.y = y;
                this.arriba = false;
                this.destruido = false;
            };

            barcos.prototype.dibujar = function () {
                if (this.arriba) {
                    for (var i = 0; i < this.numCuadrados; i++) {
                        rect(this.x, this.y + 30 * i, 30, 30);
                    }
                }
                else {
                    for (var i = 0; i < this.numCuadrados; i++) {
                        rect(this.x + 30 * i, this.y, 30, 30);
                    }
                }
            };

            barcos.prototype.isUnderMouse = function (x, y) {
                return x >= this.x && x <= this.x + 30 * this.numCuadrados &&
                    y >= this.y && y <= this.y * this.numCuadrados;
            };

            var lancha = new barcos(2, 3, 20);
            lancha.prototype = Object.create(barcos.prototype);
            var submarino = new barcos(3, 80, 20);
            submarino.prototype = Object.create(barcos.prototype);
            var crucero = new barcos(3, 184, 20);
            crucero.prototype = Object.create(barcos.prototype);
            var acorazado = new barcos(4, 288, 20);
            acorazado.prototype = Object.create(barcos.prototype);
            var portavion = new barcos(5, 360, 127);
            portavion.arriba = true;
            portavion.prototype = Object.create(barcos.prototype);

            //Tablero

            var cuadros = function (x, y, color) {
                this.x = x;
                this.y = y;
                this.size = 30;
                this.color = color;
                this.isEquivocado = false;
                this.isAcertado = false;
            };

            cuadros.prototype.dibujar = function () {
                if (this.isAcertado) {
                    fill(255, 0, 0);
                    rect(this.x, this.y, this.size, this.size);
                } else if (this.isEquivocado) {
                    fill(255, 255, 255);
                    rect(this.x, this.y, this.size, this.size);
                } else {
                    fill(61, 180, 189);
                    rect(this.x, this.y, this.size, this.size);
                }
            };

            cuadros.prototype.isMouseInside = function () {
                return mouseX > this.x &&
                    mouseX < (this.x + this.ancho) &&
                    mouseY > this.y &&
                    mouseY < (this.y + this.alto);
            };

            cuadros.prototype.isUnderMouse = function (x, y) {
                return x >= this.x && x <= this.x + this.size &&
                    y >= this.y && y <= this.y + this.size;
            };

            var playerTurn = 0;
            var SYMBOLS = ["PLAYER1", "PLAYER2"];
            /*cuadros.prototype.onClick = function() {
                // If the tile is not empty, exit the function
                if (!this.empty()){
                    return;
                }
                // Put the player's symbol on the tile
                SYMBOLS[1] = SYMBOLS[playerTurn];
                // Change the turn
                playerTurn++; 
                if (playerTurn >= SYMBOLS.length){
                    playerTurn=0;   
                }
            };*/

            var A = [];
            var B = [];
            var C = [];
            var D = [];
            var E = [];
            var F = [];
            var G = [];
            var H = [];
            var I = [];
            var J = [];

            var NUM_COLS = 10;
            for (var j = 0; j < NUM_COLS; j++) {
                var tileX = j * 30 + 40;
                A.push(new cuadros(tileX, 87));
            }
            for (var j = 0; j < NUM_COLS; j++) {
                var tileX = j * 30 + 40;
                B.push(new cuadros(tileX, 117));
            }
            for (var j = 0; j < NUM_COLS; j++) {
                var tileX = j * 30 + 40;
                C.push(new cuadros(tileX, 147));
            }
            for (var j = 0; j < NUM_COLS; j++) {
                var tileX = j * 30 + 40;
                D.push(new cuadros(tileX, 177));
            }
            for (var j = 0; j < NUM_COLS; j++) {
                var tileX = j * 30 + 40;
                E.push(new cuadros(tileX, 207));
            }
            for (var j = 0; j < NUM_COLS; j++) {
                var tileX = j * 30 + 40;
                F.push(new cuadros(tileX, 237));
            }
            for (var j = 0; j < NUM_COLS; j++) {
                var tileX = j * 30 + 40;
                G.push(new cuadros(tileX, 267));
            }
            for (var j = 0; j < NUM_COLS; j++) {
                var tileX = j * 30 + 40;
                H.push(new cuadros(tileX, 297));
            }
            for (var j = 0; j < NUM_COLS; j++) {
                var tileX = j * 30 + 40;
                I.push(new cuadros(tileX, 327));
            }
            for (var j = 0; j < NUM_COLS; j++) {
                var tileX = j * 30 + 40;
                J.push(new cuadros(tileX, 357));
            }
            for (var i = 0; i < A.length; i++) {
                A[i].dibujar();
                B[i].dibujar();
                C[i].dibujar();
                D[i].dibujar();
                E[i].dibujar();
                F[i].dibujar();
                G[i].dibujar();
                H[i].dibujar();
                I[i].dibujar();
                J[i].dibujar();
            }

            //Cambiar color de los cuadros
            var golpe = 0;
            var barcosDestruidos = 0;
            mouseClicked = function () {
                for (var i = 0; i < A.length; i++) {
                    if (A[i].isUnderMouse(mouseX, mouseY)) {
                        A[i].isAcertado = true;
                        golpe++;
                        //SYMBOLS[0] = SYMBOLS[1];
                    }
                    if (B[i].isUnderMouse(mouseX, mouseY)) {
                        B[i].isAcertado = true;
                        golpe++;

                    }
                    if (C[i].isUnderMouse(mouseX, mouseY)) {
                        C[i].isAcertado = true;
                        golpe++;
                    }
                    if (D[i].isUnderMouse(mouseX, mouseY)) {
                        D[i].isAcertado = true;
                        golpe++;
                    }
                    if (E[i].isUnderMouse(mouseX, mouseY)) {
                        E[i].isAcertado = true;
                        golpe++;
                    }
                    if (F[i].isUnderMouse(mouseX, mouseY)) {
                        F[i].isAcertado = true;
                        golpe++;
                    }
                    if (G[i].isUnderMouse(mouseX, mouseY)) {
                        G[i].isAcertado = true;
                        golpe++;
                    }
                    if (H[i].isUnderMouse(mouseX, mouseY)) {
                        H[i].isAcertado = true;
                        golpe++;
                    }
                    if (I[i].isUnderMouse(mouseX, mouseY)) {
                        I[i].isAcertado = true;
                        golpe++;
                    }
                    if (J[i].isUnderMouse(mouseX, mouseY)) {
                        J[i].isAcertado = true;
                        golpe++;
                    }
                }

                if (golpe === 2) {
                    println(golpe);
                    lancha.destruido = true;
                } else if (golpe === 3) {
                    println(golpe);
                    submarino.destruido = true;
                } else if (golpe === 4) {
                    println(golpe);
                    acorazado.destruido = true;
                } else if (golpe === 5) {
                    println(golpe);
                    portavion.destruido = true;
                }
                if (portavion.destruido) {
                    println("Destruiste el portavion");
                    barcosDestruidos++;
                } else if (acorazado.destruido) {
                    println("Destruiste el acorazado");
                    barcosDestruidos++;
                } else if (submarino.destruido) {
                    println("Destruiste el submarino");
                    barcosDestruidos++;
                }
                else if (lancha.destruido) {
                    println("Destruiste la lancha");
                    barcosDestruidos++;
                }
                println(barcosDestruidos);
                if (barcosDestruidos === 4) {
                    println("Ganaste!");
                }
            };

            draw = function () {
                background(122, 113, 89);
                text("Lancha", 31, 15);
                text("Submarino", 123, 15);
                text("Crucero", 228, 15);
                text("Acorazado", 347, 15);
                text("Portavion", 371, 292);
                fill(61, 154, 161);
                rect(10, 57, 330, 330);
                for (var i = 40; i < 339; i += 30) {
                    line(i, 57, i, 377);
                }
                for (var i = 57; i < 387; i += 30) {
                    line(10, i, 320, i);
                }
                //Letras
                fill(255, 255, 255);
                textSize(20);
                textAlign(CENTER);
                text("A", 27, 110);
                text("B", 27, 140);
                text("C", 27, 170);
                text("D", 27, 200);
                text("E", 27, 230);
                text("F", 27, 260);
                text("G", 27, 290);
                text("H", 27, 320);
                text("I", 27, 350);
                text("J", 27, 380);

                //Numeros
                for (var i = 1; i < 11; i++) {
                    text(i, 25 + i * 30, 80);
                }
                var colores = color(61, 180, 189);
                for (var i = 0; i < A.length; i++) {
                    A[i].dibujar(colores);
                    B[i].dibujar(colores);
                    C[i].dibujar(colores);
                    D[i].dibujar(colores);
                    E[i].dibujar(colores);
                    F[i].dibujar(colores);
                    G[i].dibujar(colores);
                    H[i].dibujar(colores);
                    I[i].dibujar(colores);
                    J[i].dibujar(colores);
                }

                //Dibujar barcos
                textSize(14);
                fill(247, 242, 242);
                lancha.dibujar();
                submarino.dibujar();
                crucero.dibujar();
                acorazado.dibujar();
                portavion.dibujar();

                mouseDragged = function() {
                    if (lancha.isUnderMouse(mouseX, mouseY)) {
                        //el centro de la circ. se mueve a la posición del cursor
                        lancha.x = mouseX - 30;
                        lancha.y = mouseY - 10;
                    } else if (submarino.isUnderMouse(mouseX, mouseY)) {
                        //el centro de la circ. se mueve a la posición del cursor
                        submarino.x = mouseX - 40;
                        submarino.y = mouseY - 10;
                    } else if (crucero.isUnderMouse(mouseX, mouseY)) {
                        //el centro de la circ. se mueve a la posición del cursor
                        crucero.x = mouseX - 40;
                        crucero.y = mouseY - 10;
                    } else if (acorazado.isUnderMouse(mouseX, mouseY)) {
                        //el centro de la circ. se mueve a la posición del cursor
                        acorazado.x = mouseX - 50;
                        acorazado.y = mouseY - 10;
                    } else if (portavion.isUnderMouse(mouseX, mouseY)) {
                        //el centro de la circ. se mueve a la posición del cursor
                        portavion.x = mouseX - 15;
                        portavion.y = mouseY - 60;
                    }
                    lancha.dibujar();
                    submarino.dibujar();
                    crucero.dibujar();
                    acorazado.dibujar();
                    portavion.dibujar();
                }
            };
            //if(stick.x >= A1.x && stick.x <= (A1.x + 40))
            //};
            //juego();

            /*mouseClicked = function() {
                juego();
                if(mouseX > 159 && mouseX < 239 && mouseY > 110 && mouseY < 150){
                    juego();
                }
            };*/
        }
    };

    // Get the canvas that Processing-js will use
    var canvas = document.getElementById("mycanvas");
    // Pass the function sketchProc (defined in myCode.js) to Processing's constructor.
    var processingInstance = new Processing(canvas, sketchProc); 
</script>

</html>
